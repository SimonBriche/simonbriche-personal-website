{"version":3,"file":"static/js/368.31640b73.chunk.js","mappings":"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","sources":["cmp/GalleryFilter.js","utils/Tools.js"],"sourcesContent":["import { useEffect, useState, useCallback } from \"react\";\nimport { isBootstrapAvailable, isJQueryAvailable, randomBetween } from \"../utils/Tools\";\n\nconst GalleryFilter = (props) => {\n  const bridge = props.bridgeEvent;\n  const [seed, setSeed] = useState(null);\n  const [searchFields, setSearchFields] = useState(null);\n  const [isPending, setIsPending] = useState(false);\n  const [isFirstSearch, setIsFirstSearch] = useState(false);\n\n  useEffect(() => {\n    if(isBootstrapAvailable(\"5\") && isJQueryAvailable(\"3\")){\n      (async () => {\n        const query = `{\n          portfolioSearchFields{\n            clients, types\n          }\n        }`;\n        const res = await (await fetch(`${process.env.REACT_APP_CDN_URL}/graphql?query=${encodeURIComponent(query)}`)).json();\n        setSearchFields(res.data.portfolioSearchFields);\n        window.$('.selectfilter').selectpicker();\n      })().catch(e => {console.log('getSearchFields error', e)});\n    }\n    else{\n      console.warn('Bootstrap 5 and jQuery 3 must be loaded to use GalleryFilter component');\n    }\n  }, []);\n\n  const search = useCallback((afterCursor, newSeed) => {\n    (async () => {\n      setIsFirstSearch(true);\n      setIsPending(true);\n      const res = await fetchPortfolio(afterCursor, (newSeed || seed));\n      const event = new CustomEvent(\"onGalleryTilesEvent\", {\n        detail: {\n          tiles: res.tiles,\n          after: res.after,\n          hasNextPage: res.hasNextPage,\n          isTilesAppended: !!afterCursor\n        }\n      });\n      bridge.dispatchEvent(event);\n      setIsPending(false);\n      if(newSeed){\n        setSeed(newSeed);\n      }\n    })().catch((e) => console.log(e));\n  }, [bridge, seed]);\n\n  useEffect(() => {\n    const onShowMoreTilesHandler = (e) => {\n      if(e.detail && e.detail.after){\n        search(e.detail.after);\n      }\n      else{\n        search(null, randomBetween(1, 1000));\n      }\n    }\n    bridge.addEventListener(\"onShowMoreTilesEvent\", onShowMoreTilesHandler);\n    return () => {\n      bridge.removeEventListener(\"onShowMoreTilesEvent\", onShowMoreTilesHandler);\n    }\n  }, [bridge, search]);\n\n  const onSearchHandler = () => {\n    if(!isPending){\n      search(null, randomBetween(1, 1000));\n    }\n  }\n\n  const fetchPortfolio = (afterCursor, seed) => {\n    return new Promise((resolve, reject) => {\n      (async () => {\n        const filtering = [];\n        const clientsFiltering = window.$('#clients-search').val();\n        const projectsFiltering = window.$('#projects-search').val();\n        let ordering = `orderBy:{sort:RAND, direction:ASC, seed:\"${seed}\"}`;\n\n        if(clientsFiltering.length > 0){\n          filtering.push(`{field: \"client\", operator:IN, value:${JSON.stringify(clientsFiltering)}}`);\n        }\n        if(projectsFiltering.length > 0){\n          filtering.push(`{field: \"types\", operator:IN, value:${JSON.stringify(projectsFiltering)}}`);\n        }\n        if(clientsFiltering.length > 0 || projectsFiltering.length > 0){\n          ordering = `orderBy:{sort:CLIENT, direction:ASC}`;\n        }\n\n        const query = `{\n          portfolio(\n            first: 12\n            ${ordering}\n            ${afterCursor ? `after:\"${afterCursor}\"` : ''}\n            ${filtering.length > 0 ? `filtering:[${filtering.join(',')}]` : ''}\n          ){\n            data{id, name, client, pitch, description, thumbnail, types, images, technology_ids},\n            pageInfo{\n              endCursor,\n              hasNextPage\n            }\n          }\n        }`;\n        const res = await (await fetch(`${process.env.REACT_APP_CDN_URL}/graphql?query=${encodeURIComponent(query)}`)).json();\n        if(res.data.portfolio.data){\n          resolve({\n            tiles: res.data.portfolio.data,\n            after: (res.data.portfolio.pageInfo) ? res.data.portfolio.pageInfo.endCursor : null,\n            hasNextPage: (res.data.portfolio.pageInfo) ? res.data.portfolio.pageInfo.hasNextPage : null\n          });\n        }\n        else{\n          reject(new Error(res.errors));\n        }\n      })().catch(reject);\n    });\n  }\n\n  return ( \n    <>\n      {searchFields ?\n        <div id=\"gallery-filters\" className=\"d-flex flex-column flex-sm-row justify-content-center\">\n          <select id=\"clients-search\" className=\"selectfilter mb-3 mb-sm-0 mx-auto ms-sm-0 me-sm-3\" data-style=\"btn-soft\" data-none-selected-text=\"Tous les clients\" data-actions-box=\"true\" data-select-all-text=\"Cocher\" data-deselect-all-text=\"Décocher\" multiple>\n            {searchFields.clients.map((client, index) => (\n              <option key={`client-${index}`}>{client}</option>\n            ))}\n          </select>\n          <select id=\"projects-search\" className=\"selectfilter mb-3 mb-sm-0 mx-auto ms-sm-0 me-sm-3\" data-style=\"btn-soft\" data-none-selected-text=\"Tous les projets\" data-actions-box=\"true\" data-select-all-text=\"Cocher\" data-deselect-all-text=\"Décocher\" multiple>\n            {searchFields.types.map((type, index) => (\n              <option key={`type-${index}`}>{type}</option>\n            ))}\n          </select>\n          {isFirstSearch &&\n            <button onClick={onSearchHandler} className={`btn btn-custom btn-soft text-red ${isPending ? 'pending' : ''}`} disabled={isPending}>\n              <span className=\"pending-spinner\">\n                <i className=\"fas fa-spinner fa-spin\"></i>\n              </span>\n              <i className=\"fas fa-search\"></i>\n            </button>\n          }\n        </div>\n        : <div className=\"cmp-loader\"><div className=\"lds-ring\"><div></div><div></div><div></div><div></div></div></div>\n      }\n    </>\n  );\n}\n \nexport default GalleryFilter;","//import \"lazysizes\";\n\nconst Tools = {\n  isBootstrapAvailable: (version) => {\n    if(!version) return true;\n    if(!(window.bootstrap && window.bootstrap.Modal && window.bootstrap.Modal.VERSION)) return false;\n    return window.bootstrap.Modal.VERSION.localeCompare(version, undefined, { numeric: true, sensitivity: 'base' }) >= 0;\n  },\n  isJQueryAvailable: (version) => {\n    if(!version) return true;\n    if(!(window.$ && window.$.fn && window.$.fn.jquery)) return false;\n    return window.$.fn.jquery.localeCompare(version, undefined, { numeric: true, sensitivity: 'base' }) >= 0;\n  },\n  lazyLoadImages: (el) => {\n    if('loading' in HTMLImageElement.prototype) {\n      const images = el.querySelectorAll(\"img.lazyload\");\n      images.forEach(img => {\n        img.onload = function(){\n          if(this.classList){\n            //adding the 'show' class \"nullify\" the 'fade' class that is applied to lazyload img\n            this.classList.add('show')\n          }\n        };\n        img.src = img.dataset.src;\n      });\n    }\n    else{\n      import('lazysizes');\n    }\n  },\n  randomString: function (length) {\n    const chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    let result = '';\n    for (let i = length; i > 0; --i){\n      result += chars[Math.round(Math.random() * (chars.length - 1))];\n    }\n    return result;\n  },\n  randomBetween: function(min, max){\n    return Math.ceil(max - Math.random()*(max - (min - 1)));\n  }\n}\n\nexport const isBootstrapAvailable = Tools.isBootstrapAvailable;\nexport const isJQueryAvailable = Tools.isJQueryAvailable;\nexport const lazyLoadImages = Tools.lazyLoadImages;\nexport const randomString = Tools.randomString;\nexport const randomBetween = Tools.randomBetween;\nexport default Tools;"],"names":["props","bridge","bridgeEvent","useState","seed","setSeed","searchFields","setSearchFields","isPending","setIsPending","isFirstSearch","setIsFirstSearch","useEffect","isBootstrapAvailable","isJQueryAvailable","fetch","process","encodeURIComponent","json","res","data","portfolioSearchFields","window","$","selectpicker","catch","e","console","log","warn","search","useCallback","afterCursor","newSeed","fetchPortfolio","event","CustomEvent","detail","tiles","after","hasNextPage","isTilesAppended","dispatchEvent","onShowMoreTilesHandler","randomBetween","addEventListener","removeEventListener","Promise","resolve","reject","filtering","clientsFiltering","val","projectsFiltering","ordering","length","push","JSON","stringify","query","join","portfolio","pageInfo","endCursor","Error","errors","id","className","multiple","clients","map","client","index","types","type","onClick","disabled","Tools","version","bootstrap","Modal","VERSION","localeCompare","undefined","numeric","sensitivity","fn","jquery","lazyLoadImages","el","HTMLImageElement","prototype","querySelectorAll","forEach","img","onload","this","classList","add","src","dataset","randomString","chars","result","i","Math","round","random","min","max","ceil"],"sourceRoot":""}